<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reconocimiento de voz con sonidos ğŸ¤</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      text-align: center;
      padding: 2em;
      color: #222;
    }
    input, button {
      padding: 10px;
      border-radius: 8px;
      margin: 6px;
      font-size: 14px;
    }
    button {
      cursor: pointer;
      background: #0078d7;
      border: none;
      color: #fff;
      transition: .2s;
    }
    button:hover { background: #005fa3; }
    table { margin: 20px auto; border-collapse: collapse; width: 80%; background: #fff; }
    td, th { border: 1px solid #ccc; padding: 8px; }
    #status { margin-top: 20px; font-weight: bold; }
  </style>
</head>

<body>
  <h1>ğŸ§ Frases y sonidos personalizados</h1>
  <p>Agrega tus frases. Luego presiona â€œIniciar micrÃ³fonoâ€.</p>

  <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
    <input type="text" id="frase" placeholder="Frase (ej: hola)">
    <button id="btnMP3">ğŸµ MP3</button>
    <input type="file" id="audioInput" accept="audio/*" style="display:none;">
    <input type="text" id="nombreSonido" placeholder="NingÃºn archivo" readonly>
    <button id="agregarBtn">Agregar</button>
  </div>

  <table>
    <thead><tr><th>Frase</th><th>Sonido</th></tr></thead>
    <tbody id="tabla"></tbody>
  </table>

  <button id="startBtn">ğŸ™ï¸ Iniciar micrÃ³fono</button>
  <div id="status">MicrÃ³fono apagado.</div>

  <script>
    const frases = {};
    const tabla = document.getElementById("tabla");
    const audioInput = document.getElementById("audioInput");
    const nombreSonido = document.getElementById("nombreSonido");

    let recognition;
    let escuchando = false;

    document.getElementById("btnMP3").onclick = () => audioInput.click();

    audioInput.onchange = () => {
      const file = audioInput.files[0];
      nombreSonido.value = file ? file.name : "NingÃºn archivo";
    };

    document.getElementById("agregarBtn").onclick = () => {
      const frase = document.getElementById("frase").value.trim().toLowerCase();
      const file = audioInput.files[0];

      if (!frase || !file) return alert("Completa la frase y el sonido.");

      frases[frase] = URL.createObjectURL(file);

      tabla.innerHTML += `<tr><td>${frase}</td><td>${file.name}</td></tr>`;

      document.getElementById("frase").value = "";
      audioInput.value = "";
      nombreSonido.value = "NingÃºn archivo";
    };

    // ğŸ™ï¸ Modo escucha infinita para teatro
    document.getElementById("startBtn").onclick = () => {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) return alert("Tu navegador no soporta reconocimiento de voz.");

      if (escuchando) return;
      escuchando = true;

      recognition = new SpeechRecognition();
      recognition.lang = "es-ES";
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onstart = () => status.textContent = "ğŸ™ï¸ Escuchando continuamente...";

      recognition.onresult = e => {
        const dicho = e.results[0][0].transcript.toLowerCase();
        status.textContent = `Dijiste: "${dicho}"`;

        for (const key in frases) {
          if (dicho.includes(key)) {
            const audio = new Audio(frases[key]);
            audio.play();
            status.textContent += " | ğŸ”Š Reproduciendo...
