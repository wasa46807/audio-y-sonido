<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reproductor por Frase</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      color: #222;
      text-align: center;
      padding: 2em;
    }
    h1 { color: #333; }
    input, button {
      margin: 5px;
      padding: 10px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid #aaa;
    }
    button {
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #0056b3; }
    #status {
      margin-top: 20px;
      font-weight: bold;
      color: #007bff;
    }
    .map-list { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>ðŸŽ¤ Reproductor por Frase</h1>
  <p>Agrega una frase y el sonido que quieras reproducir al decirla.</p>

  <div>
    <input id="phrase" placeholder="Frase (ej: hola mundo)" />
    <input id="audioUrl" placeholder="URL del audio (ej: https://...)" />
    <button onclick="addMapping()">AÃ±adir</button>
  </div>

  <div class="map-list" id="mapList"></div>

  <button onclick="startListening()">ðŸŽ§ Iniciar Escucha</button>
  <div id="status">MicrÃ³fono inactivo</div>

  <script>
    const mappings = {};
    const mapList = document.getElementById('mapList');
    const statusEl = document.getElementById('status');

    function addMapping() {
      const phrase = document.getElementById('phrase').value.trim().toLowerCase();
      const audioUrl = document.getElementById('audioUrl').value.trim();
      if (!phrase || !audioUrl) {
        alert('Por favor ingresa una frase y una URL de audio.');
        return;
      }
      mappings[phrase] = audioUrl;
      const item = document.createElement('p');
      item.textContent = `"${phrase}" â†’ ${audioUrl}`;
      mapList.appendChild(item);
      document.getElementById('phrase').value = '';
      document.getElementById('audioUrl').value = '';
    }

    function startListening() {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Tu navegador no soporta reconocimiento de voz.');
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'es-ES';
      recognition.continuous = true;
      recognition.interimResults = false;

      recognition.onstart = () => {
        statusEl.textContent = 'ðŸŽ™ï¸ Escuchando...';
        statusEl.style.color = '#28a745';
      };

      recognition.onend = () => {
        statusEl.textContent = 'MicrÃ³fono detenido. Pulsa "Iniciar Escucha" para continuar.';
        statusEl.style.color = '#dc3545';
      };

      recognition.onresult = (event) => {
        const said = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
        console.log('Escuchado:', said);
        if (mappings[said]) {
          const audio = new Audio(mappings[said]);
          audio.play();
        }
      };

      recognition.onerror = (event) => {
        console.error('Error:', event.error);
        statusEl.textContent = 'Error: ' + event.error;
        statusEl.style.color = '#dc3545';
      };

      recognition.start();
      alert('ðŸŽ¤ Escucha iniciada. Permite el micrÃ³fono si el navegador lo solicita.');
    }
  </script>
</body>
</html>
